name: Production Release System


on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  release:
    name: Commitizen Release
    runs-on: ubuntu-latest

    steps:
      # --------------------------------------------------
      # Checkout completo (necesario para tags)
      # --------------------------------------------------
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # --------------------------------------------------
      # Python
      # --------------------------------------------------
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # --------------------------------------------------
      # Instalar Commitizen
      # --------------------------------------------------
      - name: Install Commitizen
        run: |
          python -m pip install --upgrade pip
          pip install commitizen

      # --------------------------------------------------
      # Configurar Git (OBLIGATORIO)
      # --------------------------------------------------
      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # --------------------------------------------------
      # Bump de versi√≥n (alpha)
      # Commitizen decide TODO
      # --------------------------------------------------
      - name: Bump version (alpha)
        env:
          CZ_FORCE_COLOR: "1"
        run: |
          cz bump --prerelease alpha --yes

      # --------------------------------------------------
      # Push commit + tags
      # --------------------------------------------------
      - name: Push changes and tags
        run: |
          git push origin main
          git push origin --tags
